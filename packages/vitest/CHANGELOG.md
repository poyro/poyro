# @poyro/vitest

## 0.4.0-beta.10

### Patch Changes

- asd

## 0.4.0-beta.9

### Patch Changes

- Use import instead of require

## 0.4.0-beta.8

### Patch Changes

- Debug custom config.

## 0.4.0-beta.7

### Patch Changes

- Fix exports.

## 0.4.0-beta.6

### Patch Changes

- More optionals

## 0.4.0-beta.5

### Patch Changes

- Fix validation of `poyro.config.js` files to ensure that they are correctly interpreted and used to configure the library.

## 0.4.0-beta.4

### Patch Changes

- Make sure things are correctly optional.

## 0.4.0-beta.3

### Patch Changes

- Make sure we use correct yup validators throughout.

## 0.4.0-beta.2

### Patch Changes

- Fix validation of `poyro.config.js` files to ensure that they are correctly interpreted and used to configure the library.

## 0.4.0-beta.1

### Patch Changes

- Make sure that 'config.js' is re-exported at the top level.

## 0.4.0-beta.0

### Minor Changes

- Create a way to interpret `poyro.config.js` files to configure library.

## 0.3.4

### Patch Changes

- Update READMEs for both `@poyro/vitest` and `poyro` to include a link to the Poyro documentation and Discord, as well as fix a typo.

## 0.3.3

### Patch Changes

- e8f269c: Running the same expect twice in a row led to different outcomes, when it should not. Here is a minimal reproducing example:

  ```javascript
  import { expect, it } from "vitest";

  it("should be true", async () => {
    // This is some output generated by an LLM, the way you get it
    // is totally up to you
    const llmOutput = "Hello, world!";

    await expect(llmOutput).toFulfillCriterion("Says hello"); // passed
    await expect(llmOutput).toFulfillCriterion("Says hello"); // failed
  }, 10000); // Increase the timeout as needed with the third argument
  ```

  Upgrading to node llama 3 beta 36 resolves the problem. Node llama is in an unstable state because its in beta, but version 3 provides the functionality needed for Poyro so we're biting that cost for now.

- 3b60575: Documentation update based on feedback

  - Provide solution to get better error messages when running into NAPI errors.
  - Share other useful flags to use with vitest to get better error messages.
  - Give users a heads up that on the first matcher run the model will get downloaded.
  - Add links to Vitest and Vitest CLI docs at strategic points in our docs page.
  - Clarify the relationship between Poyro and Vitest early in the main doc page.

## 0.3.2

### Patch Changes

- Fix the prompt used for evaluation with current matcher

  The issue raised was that in some tests the evaluation model's reasoning would contradict the boolean returned by it. This boolean is what is used by the matcher to determine whether the test passes or fails. The feedback provided by the model and the booelan returned should always be consistent with one another.

  Upon inspection, we found that the actual system prompt we used had several issues:

  - It was overly long and complicated.
  - It made references to artifacts from Prometheus that were not relevant to the model currently used by Poyro.
  - It did not explicitly instruct the model to not contradict itself.
  - It did not directly instruct the feedback to make a clear True / False determination.

  We created a simplified system prompt and it works with our smaller Llama-3 model in Poyro with the test case that produced the issue. To validate the prompt change did not improve only this test case by chance we submitted the original, long prompt to GPT, meta.ai (full Llama), and Perplexity. GPT and meta.ai show the same error as the smaller model with the original prompt, with the boolean contradicting the reasoning.

  Given much more powerful models struggled with the same prompt, but were successful with a simpler prompt this strongly suggested the prompt was the prompt. This is enough evidence both from a first principles and empirical perspective to update the prompt to the new one. Speaking with current users, there were no reversions introduced into their existing tests due to the prompt change, only progressions.

## 0.3.1

### Patch Changes

- 66d61e4: Separate out grammar from `toFulfillCriterion` into its own file within the same object. This will allow for easier maintenance and better separation of concerns.

## 0.3.0

### Minor Changes

- This PR does three main things. First, it refactors the matchers into a shared singleton that is loaded by Vitest. This allows the matchers to share the model and avoid reinstantiating it for each test.

  Second, it adds context-based caching via the singleton. This allows the matchers to cache the results of the last match for each context, which can be used to avoid re-creating the model each time it is accessed.

  Finally, it switches to a Llama-3 Instruct model for the matchers. This allows the overall performance of the testing suite to be improved both in terms of quality and execution speed.

## 0.2.4

### Patch Changes

- Fix README for `@poyro/vitest` to reflect a more accurate example usage. This change is necessary to ensure that users can easily understand how to use the matchers in their tests.

  Also clean up the `toFullfillCriterion` matcher template to ensure that the feedback is concise and clear.

## 0.2.3

### Patch Changes

- We should probably build the package before publishing it. ü§¶‚Äç‚ôÇÔ∏è This will ensure that the packages are actually built prior to being released to NPM.

## 0.2.2

### Patch Changes

- c7ce42a: Fix exports in package.json. Given the change of `tsconfig.json` to target `ES2022`, pointing `main` to `dist/index.mjs` is incorrect. Instead, point `main` to `dist/index.js` and `types` to `dist/index.d.ts`.

## 0.2.1

### Patch Changes

- 2f00bc3: Remove installing the evaluation model as part of the `postinstall` script to improve performance and DX. Now, the evaluation model is installed on the first run of `vitest` following the configuration of the package.
- edfc90e: Improve testing by co-locating tests within the `@poyro/vitest` package rather than relying on a demo app. This will allow us to test the package in isolation and ensure that it works as expected.

  To continue to test a "real-world" example, we will dogfood using our `nextjs-vitest-poyro-demo` repo. This will allow us to ensure that the package also works as expected in a real-world scenario.

## 0.2.0

### Minor Changes

- f67bbec: Upgrade to node llama 3 beta

## 0.1.4

### Patch Changes

- Update README.md for `@poyro/vitest` to mention that `tsconfig.json` should be updated to reference `vitest.d.ts`.

  Also fix some minor linting issues.

## 0.1.3

### Patch Changes

- Moved `handlebars` to be a dependency for easier installation. Fixed some linting issues. Import handlebars as a singleton to avoid CJS/ESM compatibility issues.

## 0.1.2

### Patch Changes

- Ensure that `node-fetch` is correctly marked as a dependency, not a devDependency.

## 0.1.1

### Patch Changes

- This change ensures that the scripts directory is bundled with the package. This is necessary for the package to work correctly.

  It also makes minor linting changes.

## 0.1.0

### Minor Changes

- 4b2a980: This first published version creates the `@poyro/vitest` package, which provides LLM-specific matchers for unit testing on Vitest. These matchers are used to test the output of LLMs.

  Our first matcher is `toFulfillCriterion`, which is used to evaluate the output of an LLM against a binary criterion. The matcher takes the LLM output via the `expect` function, a criterion to evaluate the output against, and an optional additional context to further define. The matcher then determines whether the output meets the criterion and provides feedback based on the result if not.

  To install `@poyro/vitest`, check out the README in the package folder for instructions.
